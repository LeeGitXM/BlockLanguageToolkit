#
# Test of ENB problem data conditioner
#
Test: Data Conditioner
Show: browser "CSTR_PRODUCT_QUALITY-GDA/CSTR_ENB_PROBLEM-GDA/Cstr_Enb_Problem"

# Define data written to tags in the order: C9FlagRaw C9FlagBad
Tagset: dataqual
Step: Check Reset Condition
log: [DATE] [TIME] affirm reset action
09:39:00 Assert: C9FlagVal = NaN
09:39:00 Assert: C9FlagState = UNKNOWN

Step: Initial State Confirmation
log: [DATE] [TIME] affirm inputs zero and OK
# affirm input at nontest values
09:40:00 0.25 false
09:40:30 Assert: C9FlagVal = 0.25 "initial state of 0.25 false"

Step: Data Conditioner Test
log: [DATE] ][TIME] begin data conditioner testing

# send value with false, value with true, value and false at different times outsid the 0.5 sec window

09:41:00 0.5 false
09:41:30 Assert: C9FlagVal = 0.5 "data sent - 0.5 false"
09:42:00 1.0 true
09:42:30 Assert: C9FlagVal = 0.5 "data not sent - 1 true"
09:43:00 1.0 false
log: [DATE] ][TIME] [TTIME] badValue was TRUE but became FALSE while value was unchanged -- issue
09:42:30 Assert: C9FlagVal = 1.0 "data sent without value change 1 false"
09:44:00 1.001 false
09:44:30 Assert: C9FlagVal = 1.001 "data sent with value change - 1.001 false"
09:45:00 0.5 TRUE
09:45:30 Assert: C9FlagVal = 1.001 "data not sent - 0.5 true"
log: [DATE] ][TIME] [TTIME] attempt tot send BAD send to Quality 
09:46:00 BAD false
09:46:30 Assert: C9FlagVal = 1.001 "data not sent as quality of value was BAD"
09:47:00 0.75 TRUE
09:47:30 Assert: C9FlagVal = 1.001 "data not sent as badValue was true"
log: [DATE] ][TIME] [TTIME] attempt to return Quality to GOOD
09:48:00 GOOD false
09:48:30 Assert: C9FlagVal = 0.75 "quality became good so value should come through"
09:49:00 0.25 false
09:49:30 Assert: C9FlagVal = 0.25 "initial values reset"
09:50:00 0.5
09:50:30 Assert: C9FlagVal = 0.5 "send new value, same bad value of false - 0.5 "
log: [DATE] ][TIME] [TTIME] send a value using old badValue - wait sometime but less than the SyncInterval - then send TRUE
09:51:00 1.0
09:51:10 , true
09:51:30 Assert: C9FlagVal = 0.5 "badValue of TRUE came with delay"
09:52:00 0.25 false
09:52:30 Assert: C9FlagVal = 0.25 "test completed "