#
# Test of Stabilizer problem delay block 
#
Test: Delay and Latch
# Define variables of interest
problem = "CSTR_PRODUCT_QUALITY-GDA/CSTR_STAB_PROBLEM-GDA/Cstr_Stab_Problem"

# Show: browser $problem

# Define data written to tags in the order: connectionIn
Tagset: externaldata
Step: Check Reset Condition
09:38:00 null
09:38:15 resetDiagram($problem)
log: [DATE] [TIME] affirm reset action -- completion of reset will register source connection passing false to donwstream blocks
09:39:30 Assert: Connection = NaN "connection in reset state"
09:39:35 Assert: Delay = UNKNOWN "delay in reset state"
09:39:40 Assert: Latch = FALSE "latch in reset state"

Step: Initial State Confirmation
log: [DATE] [TIME] affirm input  
# affirm input at nontest values - make sure values change
09:39:50 UNKNOWN
09:40:00 FALSE
09:40:30 Assert: Connection = FALSE "connection initialized to false state"
09:40:35 Assert: Delay = FALSE "delay withholding data"
09:40:40 Assert: Latch = FALSE "latch remains in initial state"

Step: Data delay Test
log: [DATE] [TIME] [TTIME] begin testing delay - send 5 values at one per minute
09:41:00 TRUE 
09:42:00 FALSE
09:43:00 TRUE
09:44:00 FALSE
09:45:00 TRUE
log: [DATE] [TIME] [TTIME] check for values passed to the latch - one check per minute
09:45:30 Assert: Connection = TRUE "last value send to tag"
09:46:00 Assert: Delay = false "delay - first TRUE should not been propagated to out port"
09:45:10 Assert: Latch = false "latch - first TRUE should not have been propagated"
09:47:00 Assert: Delay = false "clock still ticking delay out port not updated"
09:48:00 Assert: Delay = false "clock still ticking delay out port not updated"
09:49:00 Assert: Delay = false "clock still ticking delay out port not updated"
09:50:00 Assert: Delay = false "clock still ticking delay out port not updated"
09:51:00 Assert: Delay = false "clock still ticking delay out port not updated"
09:51:30 Assert: Delay = true "clock ran out delay out port has updated"
log: [DATE] [TIME] [TTIME] counter on delay block as run down - pass the true to latch
09:51:45 Assert: Latch = true "latch - first value made it out"
09:52:30 Assert: Delay = false "delay - second test value passed to out port"
09:52:45 Assert: Latch = false "latch - state changed"
09:53:20 Assert: Delay = true "delay - third test value passed to out port"
09:53:30 Assert: Latch = true "latch - holding this thought"

log: [DATE] [TIME] [TTIME] check reset action
09:53:45 resetDiagram($problem)
09:54:15 Assert: Delay = UNKNOWN "delay history reset, no new data on out port - 09:44 value gone"
09:54:20 Assert: Latch = true "last value retained after reset"

