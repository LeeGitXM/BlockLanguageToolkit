#!/bin/sh
#
# Save the source tree for blt, block and common into a zip repository.
# Do not intentionally include build products. Make clean before 
# running this script.
#
#set -x
SVN=${SVN_REPO}/EMChemicals
VERS=blt-`cat $SVN/Release/VERS`
TMP=${GIT_REPO}/$VERS
# Cleanup
rm -rf $TMP
cd ${GIT_REPO}
rm -rf external/cachedir
rm -rf ils-common/bin/*
rm -rf ils-common/workspace/doc/*
rm -rf blt/workspace/*/doc/*
rm -rf blt/workspace/*/bin/*
rm -rf blt/workspace/*/temp_modl
mkdir $TMP

mkdir $TMP/external
cd ${GIT_REPO}/external; cp -a .project .classpath lib $TMP/external

mkdir $TMP/ignition-77
cd ${GIT_REPO}/ignition-77; cp -a .project .classpath lib $TMP/ignition-77

mkdir $TMP/ils-common
cd ${GIT_REPO}/ils-common/ILS_Common; cp -a .project .classpath src $TMP/ils-common
cd ${GIT_REPO}/ils-common/; cp -a *.xml $TMP/ils-common

mkdir $TMP/blt
cd ${GIT_REPO}/blt; cp -a workspace $TMP/blt

# Scrub the temp area before zipping
cd $TMP
rm -f external/lib/user-ex* 
rm -f external/lib/g2-ex* 
rm -f external/lib/cachedir
rm -rf external/.metadata
rm -rf ignition-77/.metadata
rm -rf blt/.metadata
rm -rf blt/.recommenders
rm -rf ils-common/.metadata
rm -rf ils-common/.recommenders

# Now zip and copy to subversion
cd ${GIT_REPO}/$VERS
zip -r $VERS.zip *
cp $VERS.zip $SVN/Release/src
rm -rf $TMP
