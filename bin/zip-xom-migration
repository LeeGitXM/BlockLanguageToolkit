#!/bin/sh
#
# Save the migration files into a zip for distribution.
# --- actually do the migration. NOTE: migration 
#     database is in the SFC area (shared)
#
#set -x
SVN=~/Development/ils/svn/EMChemicals/Release/src
VERS=MIGRATION
TMP=${GIT_REPO}/$VERS
# Cleanup
rm -rf $TMP
cd ${GIT_REPO}
mkdir -p $TMP
# Share name conversion library with SFC
cd ${GIT_REPO}/sfc/migration
rm -f mdb/*.db
rm -rf tags
cd mdb
./mkdatabase
cd ${GIT_REPO}/blt/migration
./clear-json
./copy-json
./migrate-all
exit
mkdir -p $TMP/config
mkdir -p $TMP/procs
./mktags > $TMP/config/sqltags.xml
cp -a json/ignition/* $TMP
cd procs/ignition
cp -a * $TMP/procs

# Now zip and copy to subversion
cd ${GIT_REPO}/$VERS
zip -r blt-migration.zip *
cp blt-migration.zip $SVN
rm -rf $TMP
